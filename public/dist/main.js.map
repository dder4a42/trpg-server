{
  "version": 3,
  "sources": ["../js/modules/sseBus.js", "../js/modules/api.js", "../js/modules/store.js", "../js/modules/saves.js", "../js/modules/game.js", "../js/modules/auth.js", "../js/main.js"],
  "sourcesContent": ["/**\r\n * SSE Bus\r\n * Single SSE connection with event and message-type dispatch.\r\n */\r\n\r\nclass SSEBus {\r\n  constructor() {\r\n    this.eventSource = null;\r\n    this.roomId = null;\r\n    this.eventHandlers = new Map();\r\n    this.messageTypeHandlers = new Map();\r\n  }\r\n\r\n  connect(roomId) {\r\n    if (this.eventSource && this.roomId === roomId) {\r\n      return;\r\n    }\r\n\r\n    this.disconnect();\r\n    this.roomId = roomId;\r\n    this.eventSource = new EventSource(`/api/stream/rooms/${roomId}/stream`);\r\n\r\n    this.eventSource.addEventListener('connected', () => {\r\n      this.emit('connected', { roomId });\r\n    });\r\n\r\n    this.eventSource.addEventListener('message', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n\r\n      console.log('[SSEBus] Received message:', data);\r\n\r\n      if (data.type) {\r\n        console.log('[SSEBus] Emitting message type:', data.type);\r\n        this.emitMessageType(data.type, data);\r\n      }\r\n\r\n      this.emit('message', data);\r\n    });\r\n\r\n    this.eventSource.addEventListener('chat', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n      this.emit('chat', data);\r\n    });\r\n\r\n    this.eventSource.addEventListener('members-updated', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n      this.emit('members-updated', data);\r\n    });\r\n\r\n    this.eventSource.onerror = (error) => {\r\n      this.emit('error', error);\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.eventSource) {\r\n      this.eventSource.close();\r\n      this.eventSource = null;\r\n      this.roomId = null;\r\n    }\r\n  }\r\n\r\n  on(eventName, handler) {\r\n    if (!this.eventHandlers.has(eventName)) {\r\n      this.eventHandlers.set(eventName, new Set());\r\n    }\r\n    const handlers = this.eventHandlers.get(eventName);\r\n    handlers.add(handler);\r\n    return () => handlers.delete(handler);\r\n  }\r\n\r\n  onMessageType(type, handler) {\r\n    if (!this.messageTypeHandlers.has(type)) {\r\n      this.messageTypeHandlers.set(type, new Set());\r\n    }\r\n    const handlers = this.messageTypeHandlers.get(type);\r\n    handlers.add(handler);\r\n    console.log(`[SSEBus] Registered handler for message type: ${type} (total: ${handlers.size})`);\r\n    return () => {\r\n      handlers.delete(handler);\r\n      console.log(`[SSEBus] Unregistered handler for message type: ${type}`);\r\n    };\r\n  }\r\n\r\n  emit(eventName, payload) {\r\n    const handlers = this.eventHandlers.get(eventName);\r\n    if (!handlers) return;\r\n    for (const handler of handlers) {\r\n      try {\r\n        handler(payload);\r\n      } catch (error) {\r\n        console.error('[SSEBus] handler error:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  emitMessageType(type, payload) {\r\n    const handlers = this.messageTypeHandlers.get(type);\r\n    console.log(`[SSEBus] emitMessageType called for type: ${type}, handlers count: ${handlers ? handlers.size : 0}`);\r\n    if (!handlers) {\r\n      console.warn(`[SSEBus] No handlers registered for message type: ${type}`);\r\n      return;\r\n    }\r\n    for (const handler of handlers) {\r\n      try {\r\n        handler(payload);\r\n      } catch (error) {\r\n        console.error('[SSEBus] message handler error:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  safeParse(raw) {\r\n    try {\r\n      return JSON.parse(raw);\r\n    } catch (error) {\r\n      console.error('[SSEBus] Failed to parse event payload:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\nexport const sseBus = new SSEBus();\r\n", "/**\r\n * Unified API client\r\n * Normalizes headers, credentials, and parsing helpers.\r\n */\r\n\r\nfunction normalizeOptions(options = {}) {\r\n  const normalized = { ...options };\r\n  normalized.credentials = options.credentials || 'include';\r\n  normalized.headers = {\r\n    ...(options.headers || {})\r\n  };\r\n\r\n  if (options.body && typeof options.body === 'object' && !(options.body instanceof FormData)) {\r\n    normalized.body = JSON.stringify(options.body);\r\n    normalized.headers['Content-Type'] = normalized.headers['Content-Type'] || 'application/json';\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nexport async function fetchResponse(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  return fetch(url, normalized);\r\n}\r\n\r\nexport async function fetchJson(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  normalized.headers = {\r\n    Accept: 'application/json',\r\n    ...normalized.headers\r\n  };\r\n\r\n  const response = await fetch(url, normalized);\r\n  let data = null;\r\n  try {\r\n    data = await response.json();\r\n  } catch (error) {\r\n    data = null;\r\n  }\r\n\r\n  return { ok: response.ok, status: response.status, data, response };\r\n}\r\n\r\nexport async function fetchText(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  normalized.headers = {\r\n    Accept: 'text/html, */*',\r\n    ...normalized.headers\r\n  };\r\n\r\n  const response = await fetch(url, normalized);\r\n  const text = await response.text();\r\n  return { ok: response.ok, status: response.status, text, response };\r\n}\r\n", "/**\r\n * Room UI State Store\r\n * Single source of truth for game page state with reactive updates.\r\n */\r\n\r\nconst initialState = {\r\n  roomId: null,\r\n\r\n  streaming: {\r\n    active: false,\r\n    targetElementId: null,\r\n    buffer: [],\r\n    fullText: '',\r\n    lastCompleteAt: null,\r\n  },\r\n\r\n  members: {\r\n    byUserId: {},\r\n    order: [],\r\n    version: 0,\r\n  },\r\n\r\n  chat: {\r\n    lastSeenTimestamp: 0,\r\n  },\r\n\r\n  notes: {\r\n    byId: {},\r\n    order: [],\r\n    version: 0,\r\n  },\r\n\r\n  combat: {\r\n    entries: [],\r\n    seenKeys: new Set(),\r\n    maxEntries: 200,\r\n    maxSeenKeys: 500,\r\n  },\r\n\r\n  statusPanel: {\r\n    lastLoadedAt: null,\r\n    loading: false,\r\n    requestSeq: 0,\r\n  },\r\n};\r\n\r\nclass Store {\r\n  constructor(initialState) {\r\n    // Deep clone manually to preserve Set objects\r\n    this.state = {\r\n      roomId: initialState.roomId,\r\n      streaming: { ...initialState.streaming, buffer: [] },\r\n      members: {\r\n        byUserId: {},\r\n        order: [],\r\n        version: 0,\r\n      },\r\n      chat: { ...initialState.chat },\r\n      notes: {\r\n        byId: {},\r\n        order: [],\r\n        version: 0,\r\n      },\r\n      combat: {\r\n        entries: [],\r\n        seenKeys: new Set(), // Preserve Set object\r\n        maxEntries: initialState.combat.maxEntries,\r\n        maxSeenKeys: initialState.combat.maxSeenKeys,\r\n      },\r\n      statusPanel: { ...initialState.statusPanel },\r\n    };\r\n    this.listeners = new Set();\r\n    this.pendingRender = false;\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n\r\n  dispatch(action) {\r\n    this.state = this.reducer(this.state, action);\r\n    this.scheduleRender();\r\n  }\r\n\r\n  reducer(state, action) {\r\n    switch (action.type) {\r\n      case 'INIT_ROOM':\r\n        return { ...state, roomId: action.payload };\r\n\r\n      case 'STREAMING_START':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            active: true,\r\n            targetElementId: action.payload.targetElementId || null,\r\n            buffer: [],\r\n            fullText: '',\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_SET_TARGET':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            targetElementId: action.payload,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_CHUNK':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            buffer: [...state.streaming.buffer, action.payload],\r\n            fullText: state.streaming.fullText + action.payload,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_FLUSH_BUFFER':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            buffer: [],\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_RESET':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            active: false,\r\n            targetElementId: null,\r\n            buffer: [],\r\n            fullText: '',\r\n            lastCompleteAt: null,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_COMPLETE':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            active: false,\r\n            lastCompleteAt: Date.now(),\r\n          },\r\n        };\r\n\r\n      case 'MEMBERS_UPDATED': {\r\n        const members = action.payload || [];\r\n        const byUserId = {};\r\n        const order = [];\r\n        members.forEach(m => {\r\n          byUserId[m.userId] = m;\r\n          order.push(m.userId);\r\n        });\r\n        return {\r\n          ...state,\r\n          members: {\r\n            byUserId,\r\n            order,\r\n            version: state.members.version + 1,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'NOTES_SYNCED': {\r\n        const notes = action.payload || [];\r\n        const byId = {};\r\n        const order = [];\r\n        notes.forEach(n => {\r\n          byId[n.id] = n;\r\n          order.push(n.id);\r\n        });\r\n        return {\r\n          ...state,\r\n          notes: {\r\n            byId,\r\n            order,\r\n            version: state.notes.version + 1,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'COMBAT_ADD_ENTRY': {\r\n        const key = action.payload.key;\r\n        \r\n        // Ensure seenKeys is a Set (defensive check)\r\n        if (!(state.combat.seenKeys instanceof Set)) {\r\n          console.error('[Store] seenKeys is not a Set! Reinitializing...');\r\n          state.combat.seenKeys = new Set();\r\n        }\r\n        \r\n        if (state.combat.seenKeys.has(key)) {\r\n          console.log('[Store] Duplicate combat entry detected, skipping:', key);\r\n          return state;\r\n        }\r\n\r\n        const newSeenKeys = new Set(state.combat.seenKeys);\r\n        newSeenKeys.add(key);\r\n\r\n        // LRU cleanup if exceeds max\r\n        if (newSeenKeys.size > state.combat.maxSeenKeys) {\r\n          const arr = Array.from(newSeenKeys);\r\n          const toRemove = arr.slice(0, arr.length - state.combat.maxSeenKeys);\r\n          toRemove.forEach(k => newSeenKeys.delete(k));\r\n        }\r\n\r\n        const newEntries = [action.payload.entry, ...state.combat.entries].slice(0, state.combat.maxEntries);\r\n\r\n        return {\r\n          ...state,\r\n          combat: {\r\n            ...state.combat,\r\n            entries: newEntries,\r\n            seenKeys: newSeenKeys,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'STATUS_PANEL_LOADING':\r\n        return {\r\n          ...state,\r\n          statusPanel: {\r\n            ...state.statusPanel,\r\n            loading: true,\r\n            requestSeq: state.statusPanel.requestSeq + 1,\r\n          },\r\n        };\r\n\r\n      case 'STATUS_PANEL_LOADED':\r\n        if (action.payload.seq < state.statusPanel.requestSeq) {\r\n          return state;\r\n        }\r\n        return {\r\n          ...state,\r\n          statusPanel: {\r\n            ...state.statusPanel,\r\n            loading: false,\r\n            lastLoadedAt: Date.now(),\r\n          },\r\n        };\r\n\r\n      default:\r\n        return state;\r\n    }\r\n  }\r\n\r\n  subscribe(listener) {\r\n    this.listeners.add(listener);\r\n    return () => this.listeners.delete(listener);\r\n  }\r\n\r\n  scheduleRender() {\r\n    if (this.pendingRender) return;\r\n    this.pendingRender = true;\r\n    requestAnimationFrame(() => {\r\n      this.pendingRender = false;\r\n      this.listeners.forEach(listener => {\r\n        try {\r\n          listener(this.state);\r\n        } catch (error) {\r\n          console.error('[Store] Listener error:', error);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport const store = new Store(initialState);\r\n", "/**\r\n * Save/Load Menu Manager\r\n * Handles game state saving and loading\r\n */\r\nimport { fetchJson, fetchText } from './api.js';\r\n\r\nexport class SaveMenuManager {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.container = document.getElementById('save-menu');\r\n    if (!this.container) return;\r\n\r\n    this.bindEvents();\r\n    this.refreshMenu();\r\n  }\r\n\r\n  bindEvents() {\r\n    this.container.addEventListener('click', (event) => {\r\n      const button = event.target.closest('button[data-action]');\r\n      if (!button) return;\r\n\r\n      const action = button.dataset.action;\r\n      const slotName = button.dataset.slot;\r\n\r\n      if (action === 'save') {\r\n        this.handleSave();\r\n      } else if (action === 'load' && slotName) {\r\n        this.handleLoad(slotName);\r\n      } else if (action === 'delete' && slotName) {\r\n        this.handleDelete(slotName);\r\n      }\r\n    });\r\n  }\r\n\r\n  setStatus(message, isError = false) {\r\n    const status = this.container.querySelector('.save-status');\r\n    if (!status) return;\r\n    status.textContent = message;\r\n    status.classList.toggle('error', isError);\r\n  }\r\n\r\n  async refreshMenu() {\r\n    try {\r\n      const { ok, text } = await fetchText(`/partials/room/${this.roomId}/saves`);\r\n      if (!ok) throw new Error('Failed to load saves');\r\n      const html = text;\r\n      this.container.innerHTML = html;\r\n      this.setStatus('');\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Refresh failed:', error);\r\n      this.setStatus('Failed to load saves', true);\r\n    }\r\n  }\r\n\r\n  getFormValues() {\r\n    const slotInput = this.container.querySelector('input[name=\"slotName\"]');\r\n    const descInput = this.container.querySelector('input[name=\"description\"]');\r\n    const slotName = slotInput ? slotInput.value.trim() : '';\r\n    const description = descInput ? descInput.value.trim() : '';\r\n    return {\r\n      slotName: slotName || undefined,\r\n      description: description || undefined,\r\n    };\r\n  }\r\n\r\n  async handleSave() {\r\n    const payload = this.getFormValues();\r\n    this.setStatus('Saving...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/save`, {\r\n        method: 'POST',\r\n        body: payload,\r\n      });\r\n      if (!ok) throw new Error('Save failed');\r\n\r\n      this.setStatus('Save complete.');\r\n      await this.refreshMenu();\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Save failed:', error);\r\n      this.setStatus('Save failed.', true);\r\n    }\r\n  }\r\n\r\n  async handleLoad(slotName) {\r\n    if (!confirm(`Load game from slot \"${slotName}\"? This will replace current game state and reload the page.`)) return;\r\n    this.setStatus('Loading...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/load`, {\r\n        method: 'POST',\r\n        body: { slotName },\r\n      });\r\n      if (!ok) throw new Error('Load failed');\r\n\r\n      this.setStatus('Load complete. Refreshing page...');\r\n      \r\n      // Reload the entire page to show restored conversation history\r\n      setTimeout(() => {\r\n        window.location.reload();\r\n      }, 500);\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Load failed:', error);\r\n      this.setStatus('Load failed.', true);\r\n    }\r\n  }\r\n\r\n  async handleDelete(slotName) {\r\n    if (!confirm(`Delete slot \"${slotName}\"?`)) return;\r\n    this.setStatus('Deleting...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/${encodeURIComponent(slotName)}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (!ok) throw new Error('Delete failed');\r\n\r\n      this.setStatus('Delete complete.');\r\n      await this.refreshMenu();\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Delete failed:', error);\r\n      this.setStatus('Delete failed.', true);\r\n    }\r\n  }\r\n\r\n  async refreshStory() {\r\n    const story = document.getElementById('story-output');\r\n    if (!story) return;\r\n\r\n    const { ok, text } = await fetchText(`/partials/room/${this.roomId}/story`);\r\n    if (!ok) throw new Error('Failed to refresh story');\r\n    story.innerHTML = text;\r\n    story.scrollTop = story.scrollHeight;\r\n  }\r\n\r\n  async refreshStatus() {\r\n    const statusBody = document.getElementById('status-body');\r\n    if (!statusBody) return;\r\n\r\n    const { ok, text } = await fetchText(`/partials/room/${this.roomId}/status`);\r\n    if (!ok) throw new Error('Failed to refresh status');\r\n    statusBody.innerHTML = text;\r\n  }\r\n}\r\n", "/**\r\n * TRPG Game Client\r\n * Main game logic and character form handling\r\n */\r\nimport { sseBus } from './sseBus.js';\r\nimport { fetchJson, fetchResponse } from './api.js';\r\nimport { store } from './store.js';\r\nexport { SaveMenuManager } from './saves.js';\r\n\r\n/**\r\n * TRPG Game Client\r\n * Manages SSE connections and game actions\r\n */\r\nexport class TRPGClient {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.eventSource = null;\r\n    this.messageBuffer = [];\r\n    this.isProcessing = false;\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    this.unsubscribeHandlers = [];\r\n    this.processedElementIds = new Set(); // Track processed streaming elements\r\n  }\r\n\r\n  /**\r\n   * Set the current element to receive streaming updates\r\n   */\r\n  setStreamingElementId(id, force = false) {\r\n    // Skip if already processed this element\r\n    if (!force && this.processedElementIds.has(id)) {\r\n      console.log('[TRPGClient] Element already processed, skipping:', id);\r\n      return;\r\n    }\r\n\r\n    const element = document.getElementById(id);\r\n    if (!element) {\r\n      console.warn('[TRPGClient] Element not found:', id);\r\n      return;\r\n    }\r\n\r\n    // Check if element already has significant content (not just indicator)\r\n    const hasContent = Array.from(element.childNodes).some(node => {\r\n      if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) return true;\r\n      if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('streaming-indicator')) return true;\r\n      return false;\r\n    });\r\n\r\n    if (hasContent && !force) {\r\n      console.log('[TRPGClient] Element already has content, skipping:', id);\r\n      this.processedElementIds.add(id);\r\n      return;\r\n    }\r\n\r\n    console.log('[TRPGClient] Setting streaming target:', id);\r\n    this.currentStreamingElementId = id;\r\n    this.currentStreamingContent = '';\r\n    this.processedElementIds.add(id);\r\n    \r\n    store.dispatch({ type: 'STREAMING_SET_TARGET', payload: id });\r\n    this.flushStreamingBuffer();\r\n  }\r\n\r\n  /**\r\n   * Flush buffered chunks to the target element\r\n   */\r\n  flushStreamingBuffer() {\r\n    const state = store.getState();\r\n    const buffer = state.streaming.buffer;\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    if (!target || buffer.length === 0) return;\r\n\r\n    const indicator = target.querySelector('.streaming-indicator');\r\n    if (indicator) indicator.remove();\r\n\r\n    buffer.forEach(chunk => {\r\n      target.appendChild(document.createTextNode(chunk));\r\n    });\r\n\r\n    const output = document.getElementById('story-output');\r\n    if (output) output.scrollTop = output.scrollHeight;\r\n\r\n    store.dispatch({ type: 'STREAMING_FLUSH_BUFFER' });\r\n  }\r\n\r\n  /**\r\n   * Initialize SSE connection for real-time updates\r\n   */\r\n  connectSSE(handlers = {}) {\r\n    this.unsubscribeHandlers.forEach((unsubscribe) => unsubscribe());\r\n    this.unsubscribeHandlers = [];\r\n\r\n    sseBus.connect(this.roomId);\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-chunk', (data) => this.handleStreamingChunk(data))\r\n    );\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-complete', (data) => this.handleStreamingComplete(data))\r\n    );\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-error', (data) => this.handleStreamingError(data))\r\n    );\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.on('message', (data) => {\r\n        if (data?.type) return;\r\n        this.appendMessage(data?.chunk || data?.content || data);\r\n      })\r\n    );\r\n\r\n    if (handlers.onChat) {\r\n      this.unsubscribeHandlers.push(\r\n        sseBus.on('chat', (message) => handlers.onChat?.(message))\r\n      );\r\n    }\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.on('error', (error) => {\r\n        console.error('SSE error:', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle an incoming streaming chunk\r\n   */\r\n  handleStreamingChunk(data) {\r\n    const chunk = data.content;\r\n    if (!chunk) return;\r\n\r\n    this.currentStreamingContent += chunk;\r\n    store.dispatch({ type: 'STREAMING_CHUNK', payload: chunk });\r\n\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    if (target) {\r\n      // Remove indicator on first chunk\r\n      const indicator = target.querySelector('.streaming-indicator');\r\n      if (indicator) indicator.remove();\r\n\r\n      // Append text\r\n      target.appendChild(document.createTextNode(chunk));\r\n      \r\n      // Scroll output\r\n      const output = document.getElementById('story-output');\r\n      if (output) output.scrollTop = output.scrollHeight;\r\n    }\r\n    // If no target, buffer will accumulate until target is set\r\n  }\r\n\r\n  /**\r\n   * Handle streaming completion\r\n   */\r\n  async handleStreamingComplete(data) {\r\n    console.log('[TRPGClient] Streaming complete');\r\n    \r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    // Use full content from server if provided, otherwise fallback to collected content\r\n    const finalContent = data.content || this.currentStreamingContent;\r\n\r\n    if (target && finalContent) {\r\n      try {\r\n        // Fetch rendered markdown\r\n        const { ok, data } = await fetchJson('/api/messages/markdown', {\r\n          method: 'POST',\r\n          body: { content: finalContent }\r\n        });\r\n        \r\n        if (ok && data?.html) {\r\n          target.innerHTML = data.html;\r\n            \r\n          // Re-scroll\r\n          const output = document.getElementById('story-output');\r\n          if (output) {\r\n            output.scrollTop = output.scrollHeight;\r\n          }\r\n        } else {\r\n          console.warn('[TRPGClient] Markdown render request failed');\r\n        }\r\n      } catch (err) {\r\n        console.error('[TRPGClient] Failed to render markdown:', err);\r\n      }\r\n    } else if (!target) {\r\n      console.warn('[TRPGClient] No target element for markdown rendering');\r\n    }\r\n\r\n    this.setProcessing(false);\r\n    this.refreshStatus();\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    store.dispatch({ type: 'STREAMING_COMPLETE' });\r\n  }\r\n\r\n  /**\r\n   * Handle streaming error\r\n   */\r\n  handleStreamingError(data) {\r\n    console.error('[TRPGClient] Streaming error:', data.error);\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n    \r\n    if (target) {\r\n      // Safe error rendering\r\n      target.innerHTML = '';\r\n      const errorDiv = document.createElement('div');\r\n      errorDiv.className = 'error-message';\r\n      errorDiv.textContent = `Error: ${data.error || 'Unknown error'}`;\r\n      target.appendChild(errorDiv);\r\n    }\r\n    \r\n    this.setProcessing(false);\r\n  }\r\n\r\n  /**\r\n   * Disconnect SSE\r\n   */\r\n  disconnectSSE() {\r\n    this.unsubscribeHandlers.forEach((unsubscribe) => unsubscribe());\r\n    this.unsubscribeHandlers = [];\r\n  }\r\n\r\n  /**\r\n   * Append message to story output (Legacy fallback)\r\n   */\r\n  appendMessage(content) {\r\n    const output = document.getElementById('story-output');\r\n    if (!output) return;\r\n\r\n    // Create message element\r\n    const msgDiv = document.createElement('div');\r\n    msgDiv.className = 'message assistant streaming';\r\n    msgDiv.textContent = typeof content === 'string' ? content : JSON.stringify(content);\r\n\r\n    output.appendChild(msgDiv);\r\n    output.scrollTop = output.scrollHeight;\r\n\r\n    // Remove streaming class after animation\r\n    setTimeout(() => {\r\n      msgDiv.classList.remove('streaming');\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Set processing state\r\n   */\r\n  setProcessing(processing) {\r\n    this.isProcessing = processing;\r\n    const actionForm = document.getElementById('action-form');\r\n    const input = actionForm ? actionForm.querySelector('#action-input') : document.querySelector('#action-input');\r\n    const button = actionForm ? actionForm.querySelector('button[type=\"submit\"]') : null;\r\n    const spinner = document.getElementById('input-spinner');\r\n\r\n    if (input) {\r\n      input.disabled = processing;\r\n    }\r\n    if (button) {\r\n      button.disabled = processing;\r\n    }\r\n\r\n    if (spinner) {\r\n      spinner.classList.toggle('visible', processing);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send action via fetch\r\n   */\r\n  async sendAction(form) {\r\n    if (this.isProcessing) return;\r\n\r\n    const formData = new FormData(form);\r\n    const action = formData.get('action');\r\n    if (!action) return;\r\n\r\n    // Reset streaming state for new action\r\n    console.log('[TRPGClient] Starting new action, resetting streaming state');\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    store.dispatch({ type: 'STREAMING_RESET' });\r\n\r\n    this.setProcessing(true);\r\n\r\n    const input = form.querySelector('#action-input');\r\n    if (input) {\r\n      input.value = '';\r\n      input.focus();\r\n    }\r\n\r\n    try {\r\n      const response = await fetchResponse('/api/rooms/collect-action', {\r\n        method: 'POST',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest'\r\n        },\r\n        body: Object.fromEntries(formData.entries()),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to send action');\r\n      }\r\n\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType && contentType.includes('text/html')) {\r\n        const html = await response.text();\r\n        const output = document.getElementById('story-output');\r\n        if (output) {\r\n          output.insertAdjacentHTML('beforeend', html);\r\n          output.scrollTop = output.scrollHeight;\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        console.log('Action recorded:', data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending action:', error);\r\n      alert('Failed to send action. Please try again.');\r\n      this.setProcessing(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Append user message to output\r\n   */\r\n  appendUserMessage(content) {\r\n    const output = document.getElementById('story-output');\r\n    if (!output) return;\r\n\r\n    const msgDiv = document.createElement('div');\r\n    msgDiv.className = 'message user';\r\n    msgDiv.innerHTML = `<div class=\"message-header\">You</div><div class=\"message-content\">${this.escapeHtml(content)}</div>`;\r\n\r\n    output.appendChild(msgDiv);\r\n    output.scrollTop = output.scrollHeight;\r\n  }\r\n\r\n  /**\r\n   * Escape HTML to prevent XSS\r\n   */\r\n  escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Refresh status bar\r\n   */\r\n  async refreshStatus() {\r\n    if (typeof window.loadStatusPanel === 'function') {\r\n      return window.loadStatusPanel();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Character Form Utilities\r\n */\r\nexport class CharacterForm {\r\n  constructor() {\r\n    this.initAbilityScoreModifiers();\r\n    this.initPointBuy();\r\n  }\r\n\r\n  /**\r\n   * Update modifier display when ability scores change\r\n   */\r\n  initAbilityScoreModifiers() {\r\n    const inputs = document.querySelectorAll('.ability-score input');\r\n    inputs.forEach((input) => {\r\n      input.addEventListener('input', () => {\r\n        this.updateModifier(input);\r\n        this.updatePointBuyTotal();\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update modifier display for an ability score\r\n   */\r\n  updateModifier(input) {\r\n    const score = parseInt(input.value) || 10;\r\n    const modifier = Math.floor((score - 10) / 2);\r\n    const modifierSpan = input.parentElement.querySelector('.modifier');\r\n    if (modifierSpan) {\r\n      modifierSpan.textContent = modifier >= 0 ? `+${modifier}` : `${modifier}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize point buy system (optional)\r\n   */\r\n  initPointBuy() {\r\n    // TODO: Implement point buy system\r\n  }\r\n\r\n  /**\r\n   * Update point buy total\r\n   */\r\n  updatePointBuyTotal() {\r\n    // TODO: Calculate point buy cost\r\n  }\r\n}\r\n", "/**\r\n * Authentication Form Handler\r\n * Handles login and register form submissions\r\n */\r\nexport class AuthFormHandler {\r\n  constructor() {\r\n    this.initLoginForm();\r\n    this.initRegisterForm();\r\n  }\r\n\r\n  /**\r\n   * Initialize login form handler\r\n   */\r\n  initLoginForm() {\r\n    const form = document.getElementById('loginForm');\r\n    if (!form) return;\r\n\r\n    form.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n      const errorDiv = document.getElementById('loginError');\r\n      errorDiv.classList.remove('visible');\r\n\r\n      const formData = new FormData(e.target);\r\n      const data = {\r\n        usernameOrEmail: formData.get('usernameOrEmail'),\r\n        password: formData.get('password'),\r\n      };\r\n\r\n      try {\r\n        const response = await fetch('/auth/login', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(data),\r\n        });\r\n\r\n        const result = await response.json();\r\n\r\n        if (response.ok && result.success) {\r\n          e.target.reset();\r\n          document.getElementById('usernameOrEmail').value = '';\r\n          document.getElementById('password').value = '';\r\n          window.location.href = '/';\r\n        } else {\r\n          errorDiv.textContent = result.error?.message || 'Login failed';\r\n          errorDiv.classList.add('visible');\r\n        }\r\n      } catch (error) {\r\n        errorDiv.textContent = 'Network error. Please try again.';\r\n        errorDiv.classList.add('visible');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize register form handler\r\n   */\r\n  initRegisterForm() {\r\n    const form = document.getElementById('registerForm');\r\n    if (!form) return;\r\n\r\n    form.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n      const errorDiv = document.getElementById('registerError');\r\n      errorDiv.classList.remove('visible');\r\n\r\n      const formData = new FormData(e.target);\r\n      const data = {\r\n        username: formData.get('username'),\r\n        email: formData.get('email'),\r\n        password: formData.get('password'),\r\n      };\r\n\r\n      try {\r\n        const response = await fetch('/auth/register', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(data),\r\n        });\r\n\r\n        const result = await response.json();\r\n\r\n        if (response.ok && result.success) {\r\n          e.target.reset();\r\n          document.getElementById('regUsername').value = '';\r\n          document.getElementById('regEmail').value = '';\r\n          document.getElementById('regPassword').value = '';\r\n          window.location.href = '/';\r\n        } else {\r\n          errorDiv.textContent = result.error?.message || 'Registration failed';\r\n          errorDiv.classList.add('visible');\r\n        }\r\n      } catch (error) {\r\n        errorDiv.textContent = 'Network error. Please try again.';\r\n        errorDiv.classList.add('visible');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize logout handler\r\n */\r\nexport function initLogout() {\r\n  const form = document.getElementById('logoutForm');\r\n  if (!form) return;\r\n\r\n  form.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    await fetch('/auth/logout', { method: 'POST' });\r\n    window.location.href = '/login';\r\n  });\r\n}\r\n", "/**\r\n * Main Entry Point\r\n * Initializes global functionality across all pages\r\n */\r\nimport { AuthFormHandler, initLogout } from './modules/auth.js';\r\nimport { CharacterForm } from './modules/game.js';\r\n\r\n// Wait for DOM to be ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  // Initialize authentication forms if present\r\n  const loginForm = document.getElementById('loginForm');\r\n  const registerForm = document.getElementById('registerForm');\r\n  if (loginForm || registerForm) {\r\n    new AuthFormHandler();\r\n  }\r\n\r\n  // Initialize logout handler\r\n  initLogout();\r\n\r\n  // Initialize character form if present\r\n  const characterForm = document.querySelector('.character-form');\r\n  if (characterForm) {\r\n    new CharacterForm();\r\n  }\r\n\r\n  // Handle character deletion\r\n  document.body.addEventListener('click', async (evt) => {\r\n    if (evt.target.matches('.delete-character-btn')) {\r\n      const btn = evt.target;\r\n      const charId = btn.dataset.characterId;\r\n      const message = btn.dataset.confirm || 'Are you sure you want to delete this character?';\r\n      \r\n      if (confirm(message)) {\r\n        try {\r\n          const response = await fetch(`/api/characters/${charId}`, {\r\n             method: 'DELETE'\r\n          });\r\n          \r\n          if (response.ok) {\r\n             window.location.reload();\r\n          } else {\r\n             console.error('Delete failed');\r\n             alert('Failed to delete character');\r\n          }\r\n        } catch (err) {\r\n          console.error('Delete error', err);\r\n          alert('Error deleting character');\r\n        }\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\n/**\r\n * Export for use in inline scripts (legacy support)\r\n */\r\nwindow.TRPGClient = () => import('./modules/game.js').then(m => m.TRPGClient);\r\nwindow.CharacterForm = () => import('./modules/game.js').then(m => m.CharacterForm);\r\nwindow.SaveMenuManager = () => import('./modules/saves.js').then(m => m.SaveMenuManager);\r\n"],
  "mappings": "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",
  "names": ["initialState", "data"]
}
