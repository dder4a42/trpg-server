{
  "version": 3,
  "sources": ["../js/modules/sseBus.js", "../js/modules/api.js", "../js/modules/store.js", "../js/modules/saves.js", "../js/modules/game.js", "../js/modules/notes.js", "../js/modules/chat.js", "../js/modules/members.js", "../js/modules/combatEvents.js", "../js/game-client.js"],
  "sourcesContent": ["/**\r\n * SSE Bus\r\n * Single SSE connection with event and message-type dispatch.\r\n */\r\n\r\nclass SSEBus {\r\n  constructor() {\r\n    this.eventSource = null;\r\n    this.roomId = null;\r\n    this.eventHandlers = new Map();\r\n    this.messageTypeHandlers = new Map();\r\n  }\r\n\r\n  connect(roomId) {\r\n    if (this.eventSource && this.roomId === roomId) {\r\n      return;\r\n    }\r\n\r\n    this.disconnect();\r\n    this.roomId = roomId;\r\n    this.eventSource = new EventSource(`/api/stream/rooms/${roomId}/stream`);\r\n\r\n    this.eventSource.addEventListener('connected', () => {\r\n      this.emit('connected', { roomId });\r\n    });\r\n\r\n    this.eventSource.addEventListener('message', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n\r\n      console.log('[SSEBus] Received message:', data);\r\n\r\n      if (data.type) {\r\n        console.log('[SSEBus] Emitting message type:', data.type);\r\n        this.emitMessageType(data.type, data);\r\n      }\r\n\r\n      this.emit('message', data);\r\n    });\r\n\r\n    this.eventSource.addEventListener('chat', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n      this.emit('chat', data);\r\n    });\r\n\r\n    this.eventSource.addEventListener('members-updated', (event) => {\r\n      const data = this.safeParse(event.data);\r\n      if (!data) return;\r\n      this.emit('members-updated', data);\r\n    });\r\n\r\n    this.eventSource.onerror = (error) => {\r\n      this.emit('error', error);\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.eventSource) {\r\n      this.eventSource.close();\r\n      this.eventSource = null;\r\n      this.roomId = null;\r\n    }\r\n  }\r\n\r\n  on(eventName, handler) {\r\n    if (!this.eventHandlers.has(eventName)) {\r\n      this.eventHandlers.set(eventName, new Set());\r\n    }\r\n    const handlers = this.eventHandlers.get(eventName);\r\n    handlers.add(handler);\r\n    return () => handlers.delete(handler);\r\n  }\r\n\r\n  onMessageType(type, handler) {\r\n    if (!this.messageTypeHandlers.has(type)) {\r\n      this.messageTypeHandlers.set(type, new Set());\r\n    }\r\n    const handlers = this.messageTypeHandlers.get(type);\r\n    handlers.add(handler);\r\n    console.log(`[SSEBus] Registered handler for message type: ${type} (total: ${handlers.size})`);\r\n    return () => {\r\n      handlers.delete(handler);\r\n      console.log(`[SSEBus] Unregistered handler for message type: ${type}`);\r\n    };\r\n  }\r\n\r\n  emit(eventName, payload) {\r\n    const handlers = this.eventHandlers.get(eventName);\r\n    if (!handlers) return;\r\n    for (const handler of handlers) {\r\n      try {\r\n        handler(payload);\r\n      } catch (error) {\r\n        console.error('[SSEBus] handler error:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  emitMessageType(type, payload) {\r\n    const handlers = this.messageTypeHandlers.get(type);\r\n    console.log(`[SSEBus] emitMessageType called for type: ${type}, handlers count: ${handlers ? handlers.size : 0}`);\r\n    if (!handlers) {\r\n      console.warn(`[SSEBus] No handlers registered for message type: ${type}`);\r\n      return;\r\n    }\r\n    for (const handler of handlers) {\r\n      try {\r\n        handler(payload);\r\n      } catch (error) {\r\n        console.error('[SSEBus] message handler error:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  safeParse(raw) {\r\n    try {\r\n      return JSON.parse(raw);\r\n    } catch (error) {\r\n      console.error('[SSEBus] Failed to parse event payload:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\nexport const sseBus = new SSEBus();\r\n", "/**\r\n * Unified API client\r\n * Normalizes headers, credentials, and parsing helpers.\r\n */\r\n\r\nfunction normalizeOptions(options = {}) {\r\n  const normalized = { ...options };\r\n  normalized.credentials = options.credentials || 'include';\r\n  normalized.headers = {\r\n    ...(options.headers || {})\r\n  };\r\n\r\n  if (options.body && typeof options.body === 'object' && !(options.body instanceof FormData)) {\r\n    normalized.body = JSON.stringify(options.body);\r\n    normalized.headers['Content-Type'] = normalized.headers['Content-Type'] || 'application/json';\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nexport async function fetchResponse(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  return fetch(url, normalized);\r\n}\r\n\r\nexport async function fetchJson(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  normalized.headers = {\r\n    Accept: 'application/json',\r\n    ...normalized.headers\r\n  };\r\n\r\n  const response = await fetch(url, normalized);\r\n  let data = null;\r\n  try {\r\n    data = await response.json();\r\n  } catch (error) {\r\n    data = null;\r\n  }\r\n\r\n  return { ok: response.ok, status: response.status, data, response };\r\n}\r\n\r\nexport async function fetchText(url, options = {}) {\r\n  const normalized = normalizeOptions(options);\r\n  normalized.headers = {\r\n    Accept: 'text/html, */*',\r\n    ...normalized.headers\r\n  };\r\n\r\n  const response = await fetch(url, normalized);\r\n  const text = await response.text();\r\n  return { ok: response.ok, status: response.status, text, response };\r\n}\r\n", "/**\r\n * Room UI State Store\r\n * Single source of truth for game page state with reactive updates.\r\n */\r\n\r\nconst initialState = {\r\n  roomId: null,\r\n\r\n  streaming: {\r\n    active: false,\r\n    targetElementId: null,\r\n    buffer: [],\r\n    fullText: '',\r\n    lastCompleteAt: null,\r\n  },\r\n\r\n  members: {\r\n    byUserId: {},\r\n    order: [],\r\n    version: 0,\r\n  },\r\n\r\n  chat: {\r\n    lastSeenTimestamp: 0,\r\n  },\r\n\r\n  notes: {\r\n    byId: {},\r\n    order: [],\r\n    version: 0,\r\n  },\r\n\r\n  combat: {\r\n    entries: [],\r\n    seenKeys: new Set(),\r\n    maxEntries: 200,\r\n    maxSeenKeys: 500,\r\n  },\r\n\r\n  statusPanel: {\r\n    lastLoadedAt: null,\r\n    loading: false,\r\n    requestSeq: 0,\r\n  },\r\n};\r\n\r\nclass Store {\r\n  constructor(initialState) {\r\n    // Deep clone manually to preserve Set objects\r\n    this.state = {\r\n      roomId: initialState.roomId,\r\n      streaming: { ...initialState.streaming, buffer: [] },\r\n      members: {\r\n        byUserId: {},\r\n        order: [],\r\n        version: 0,\r\n      },\r\n      chat: { ...initialState.chat },\r\n      notes: {\r\n        byId: {},\r\n        order: [],\r\n        version: 0,\r\n      },\r\n      combat: {\r\n        entries: [],\r\n        seenKeys: new Set(), // Preserve Set object\r\n        maxEntries: initialState.combat.maxEntries,\r\n        maxSeenKeys: initialState.combat.maxSeenKeys,\r\n      },\r\n      statusPanel: { ...initialState.statusPanel },\r\n    };\r\n    this.listeners = new Set();\r\n    this.pendingRender = false;\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n\r\n  dispatch(action) {\r\n    this.state = this.reducer(this.state, action);\r\n    this.scheduleRender();\r\n  }\r\n\r\n  reducer(state, action) {\r\n    switch (action.type) {\r\n      case 'INIT_ROOM':\r\n        return { ...state, roomId: action.payload };\r\n\r\n      case 'STREAMING_START':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            active: true,\r\n            targetElementId: action.payload.targetElementId || null,\r\n            buffer: [],\r\n            fullText: '',\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_SET_TARGET':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            targetElementId: action.payload,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_CHUNK':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            buffer: [...state.streaming.buffer, action.payload],\r\n            fullText: state.streaming.fullText + action.payload,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_FLUSH_BUFFER':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            buffer: [],\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_RESET':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            active: false,\r\n            targetElementId: null,\r\n            buffer: [],\r\n            fullText: '',\r\n            lastCompleteAt: null,\r\n          },\r\n        };\r\n\r\n      case 'STREAMING_COMPLETE':\r\n        return {\r\n          ...state,\r\n          streaming: {\r\n            ...state.streaming,\r\n            active: false,\r\n            lastCompleteAt: Date.now(),\r\n          },\r\n        };\r\n\r\n      case 'MEMBERS_UPDATED': {\r\n        const members = action.payload || [];\r\n        const byUserId = {};\r\n        const order = [];\r\n        members.forEach(m => {\r\n          byUserId[m.userId] = m;\r\n          order.push(m.userId);\r\n        });\r\n        return {\r\n          ...state,\r\n          members: {\r\n            byUserId,\r\n            order,\r\n            version: state.members.version + 1,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'NOTES_SYNCED': {\r\n        const notes = action.payload || [];\r\n        const byId = {};\r\n        const order = [];\r\n        notes.forEach(n => {\r\n          byId[n.id] = n;\r\n          order.push(n.id);\r\n        });\r\n        return {\r\n          ...state,\r\n          notes: {\r\n            byId,\r\n            order,\r\n            version: state.notes.version + 1,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'COMBAT_ADD_ENTRY': {\r\n        const key = action.payload.key;\r\n        \r\n        // Ensure seenKeys is a Set (defensive check)\r\n        if (!(state.combat.seenKeys instanceof Set)) {\r\n          console.error('[Store] seenKeys is not a Set! Reinitializing...');\r\n          state.combat.seenKeys = new Set();\r\n        }\r\n        \r\n        if (state.combat.seenKeys.has(key)) {\r\n          console.log('[Store] Duplicate combat entry detected, skipping:', key);\r\n          return state;\r\n        }\r\n\r\n        const newSeenKeys = new Set(state.combat.seenKeys);\r\n        newSeenKeys.add(key);\r\n\r\n        // LRU cleanup if exceeds max\r\n        if (newSeenKeys.size > state.combat.maxSeenKeys) {\r\n          const arr = Array.from(newSeenKeys);\r\n          const toRemove = arr.slice(0, arr.length - state.combat.maxSeenKeys);\r\n          toRemove.forEach(k => newSeenKeys.delete(k));\r\n        }\r\n\r\n        const newEntries = [action.payload.entry, ...state.combat.entries].slice(0, state.combat.maxEntries);\r\n\r\n        return {\r\n          ...state,\r\n          combat: {\r\n            ...state.combat,\r\n            entries: newEntries,\r\n            seenKeys: newSeenKeys,\r\n          },\r\n        };\r\n      }\r\n\r\n      case 'STATUS_PANEL_LOADING':\r\n        return {\r\n          ...state,\r\n          statusPanel: {\r\n            ...state.statusPanel,\r\n            loading: true,\r\n            requestSeq: state.statusPanel.requestSeq + 1,\r\n          },\r\n        };\r\n\r\n      case 'STATUS_PANEL_LOADED':\r\n        if (action.payload.seq < state.statusPanel.requestSeq) {\r\n          return state;\r\n        }\r\n        return {\r\n          ...state,\r\n          statusPanel: {\r\n            ...state.statusPanel,\r\n            loading: false,\r\n            lastLoadedAt: Date.now(),\r\n          },\r\n        };\r\n\r\n      default:\r\n        return state;\r\n    }\r\n  }\r\n\r\n  subscribe(listener) {\r\n    this.listeners.add(listener);\r\n    return () => this.listeners.delete(listener);\r\n  }\r\n\r\n  scheduleRender() {\r\n    if (this.pendingRender) return;\r\n    this.pendingRender = true;\r\n    requestAnimationFrame(() => {\r\n      this.pendingRender = false;\r\n      this.listeners.forEach(listener => {\r\n        try {\r\n          listener(this.state);\r\n        } catch (error) {\r\n          console.error('[Store] Listener error:', error);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport const store = new Store(initialState);\r\n", "/**\r\n * Save/Load Menu Manager\r\n * Handles game state saving and loading\r\n */\r\nimport { fetchJson, fetchText } from './api.js';\r\n\r\nexport class SaveMenuManager {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.container = document.getElementById('save-menu');\r\n    if (!this.container) return;\r\n\r\n    this.bindEvents();\r\n    this.refreshMenu();\r\n  }\r\n\r\n  bindEvents() {\r\n    this.container.addEventListener('click', (event) => {\r\n      const button = event.target.closest('button[data-action]');\r\n      if (!button) return;\r\n\r\n      const action = button.dataset.action;\r\n      const slotName = button.dataset.slot;\r\n\r\n      if (action === 'save') {\r\n        this.handleSave();\r\n      } else if (action === 'load' && slotName) {\r\n        this.handleLoad(slotName);\r\n      } else if (action === 'delete' && slotName) {\r\n        this.handleDelete(slotName);\r\n      }\r\n    });\r\n  }\r\n\r\n  setStatus(message, isError = false) {\r\n    const status = this.container.querySelector('.save-status');\r\n    if (!status) return;\r\n    status.textContent = message;\r\n    status.classList.toggle('error', isError);\r\n  }\r\n\r\n  async refreshMenu() {\r\n    try {\r\n      const { ok, text } = await fetchText(`/partials/room/${this.roomId}/saves`);\r\n      if (!ok) throw new Error('Failed to load saves');\r\n      const html = text;\r\n      this.container.innerHTML = html;\r\n      this.setStatus('');\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Refresh failed:', error);\r\n      this.setStatus('Failed to load saves', true);\r\n    }\r\n  }\r\n\r\n  getFormValues() {\r\n    const slotInput = this.container.querySelector('input[name=\"slotName\"]');\r\n    const descInput = this.container.querySelector('input[name=\"description\"]');\r\n    const slotName = slotInput ? slotInput.value.trim() : '';\r\n    const description = descInput ? descInput.value.trim() : '';\r\n    return {\r\n      slotName: slotName || undefined,\r\n      description: description || undefined,\r\n    };\r\n  }\r\n\r\n  async handleSave() {\r\n    const payload = this.getFormValues();\r\n    this.setStatus('Saving...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/save`, {\r\n        method: 'POST',\r\n        body: payload,\r\n      });\r\n      if (!ok) throw new Error('Save failed');\r\n\r\n      this.setStatus('Save complete.');\r\n      await this.refreshMenu();\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Save failed:', error);\r\n      this.setStatus('Save failed.', true);\r\n    }\r\n  }\r\n\r\n  async handleLoad(slotName) {\r\n    if (!confirm(`Load game from slot \"${slotName}\"? This will replace current game state and reload the page.`)) return;\r\n    this.setStatus('Loading...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/load`, {\r\n        method: 'POST',\r\n        body: { slotName },\r\n      });\r\n      if (!ok) throw new Error('Load failed');\r\n\r\n      this.setStatus('Load complete. Refreshing page...');\r\n      \r\n      // Reload the entire page to show restored conversation history\r\n      setTimeout(() => {\r\n        window.location.reload();\r\n      }, 500);\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Load failed:', error);\r\n      this.setStatus('Load failed.', true);\r\n    }\r\n  }\r\n\r\n  async handleDelete(slotName) {\r\n    if (!confirm(`Delete slot \"${slotName}\"?`)) return;\r\n    this.setStatus('Deleting...');\r\n\r\n    try {\r\n      const { ok } = await fetchJson(`/api/saves/rooms/${this.roomId}/${encodeURIComponent(slotName)}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (!ok) throw new Error('Delete failed');\r\n\r\n      this.setStatus('Delete complete.');\r\n      await this.refreshMenu();\r\n    } catch (error) {\r\n      console.error('[SaveMenu] Delete failed:', error);\r\n      this.setStatus('Delete failed.', true);\r\n    }\r\n  }\r\n\r\n  async refreshStory() {\r\n    const story = document.getElementById('story-output');\r\n    if (!story) return;\r\n\r\n    const { ok, text } = await fetchText(`/partials/room/${this.roomId}/story`);\r\n    if (!ok) throw new Error('Failed to refresh story');\r\n    story.innerHTML = text;\r\n    story.scrollTop = story.scrollHeight;\r\n  }\r\n\r\n  async refreshStatus() {\r\n    const statusBody = document.getElementById('status-body');\r\n    if (!statusBody) return;\r\n\r\n    const { ok, text } = await fetchText(`/partials/room/${this.roomId}/status`);\r\n    if (!ok) throw new Error('Failed to refresh status');\r\n    statusBody.innerHTML = text;\r\n  }\r\n}\r\n", "/**\r\n * TRPG Game Client\r\n * Main game logic and character form handling\r\n */\r\nimport { sseBus } from './sseBus.js';\r\nimport { fetchJson, fetchResponse } from './api.js';\r\nimport { store } from './store.js';\r\nexport { SaveMenuManager } from './saves.js';\r\n\r\n/**\r\n * TRPG Game Client\r\n * Manages SSE connections and game actions\r\n */\r\nexport class TRPGClient {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.eventSource = null;\r\n    this.messageBuffer = [];\r\n    this.isProcessing = false;\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    this.unsubscribeHandlers = [];\r\n    this.processedElementIds = new Set(); // Track processed streaming elements\r\n  }\r\n\r\n  /**\r\n   * Set the current element to receive streaming updates\r\n   */\r\n  setStreamingElementId(id, force = false) {\r\n    // Skip if already processed this element\r\n    if (!force && this.processedElementIds.has(id)) {\r\n      console.log('[TRPGClient] Element already processed, skipping:', id);\r\n      return;\r\n    }\r\n\r\n    const element = document.getElementById(id);\r\n    if (!element) {\r\n      console.warn('[TRPGClient] Element not found:', id);\r\n      return;\r\n    }\r\n\r\n    // Check if element already has significant content (not just indicator)\r\n    const hasContent = Array.from(element.childNodes).some(node => {\r\n      if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) return true;\r\n      if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('streaming-indicator')) return true;\r\n      return false;\r\n    });\r\n\r\n    if (hasContent && !force) {\r\n      console.log('[TRPGClient] Element already has content, skipping:', id);\r\n      this.processedElementIds.add(id);\r\n      return;\r\n    }\r\n\r\n    console.log('[TRPGClient] Setting streaming target:', id);\r\n    this.currentStreamingElementId = id;\r\n    this.currentStreamingContent = '';\r\n    this.processedElementIds.add(id);\r\n    \r\n    store.dispatch({ type: 'STREAMING_SET_TARGET', payload: id });\r\n    this.flushStreamingBuffer();\r\n  }\r\n\r\n  /**\r\n   * Flush buffered chunks to the target element\r\n   */\r\n  flushStreamingBuffer() {\r\n    const state = store.getState();\r\n    const buffer = state.streaming.buffer;\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    if (!target || buffer.length === 0) return;\r\n\r\n    const indicator = target.querySelector('.streaming-indicator');\r\n    if (indicator) indicator.remove();\r\n\r\n    buffer.forEach(chunk => {\r\n      target.appendChild(document.createTextNode(chunk));\r\n    });\r\n\r\n    const output = document.getElementById('story-output');\r\n    if (output) output.scrollTop = output.scrollHeight;\r\n\r\n    store.dispatch({ type: 'STREAMING_FLUSH_BUFFER' });\r\n  }\r\n\r\n  /**\r\n   * Initialize SSE connection for real-time updates\r\n   */\r\n  connectSSE(handlers = {}) {\r\n    this.unsubscribeHandlers.forEach((unsubscribe) => unsubscribe());\r\n    this.unsubscribeHandlers = [];\r\n\r\n    sseBus.connect(this.roomId);\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-chunk', (data) => this.handleStreamingChunk(data))\r\n    );\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-complete', (data) => this.handleStreamingComplete(data))\r\n    );\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.onMessageType('streaming-error', (data) => this.handleStreamingError(data))\r\n    );\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.on('message', (data) => {\r\n        if (data?.type) return;\r\n        this.appendMessage(data?.chunk || data?.content || data);\r\n      })\r\n    );\r\n\r\n    if (handlers.onChat) {\r\n      this.unsubscribeHandlers.push(\r\n        sseBus.on('chat', (message) => handlers.onChat?.(message))\r\n      );\r\n    }\r\n\r\n    this.unsubscribeHandlers.push(\r\n      sseBus.on('error', (error) => {\r\n        console.error('SSE error:', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle an incoming streaming chunk\r\n   */\r\n  handleStreamingChunk(data) {\r\n    const chunk = data.content;\r\n    if (!chunk) return;\r\n\r\n    this.currentStreamingContent += chunk;\r\n    store.dispatch({ type: 'STREAMING_CHUNK', payload: chunk });\r\n\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    if (target) {\r\n      // Remove indicator on first chunk\r\n      const indicator = target.querySelector('.streaming-indicator');\r\n      if (indicator) indicator.remove();\r\n\r\n      // Append text\r\n      target.appendChild(document.createTextNode(chunk));\r\n      \r\n      // Scroll output\r\n      const output = document.getElementById('story-output');\r\n      if (output) output.scrollTop = output.scrollHeight;\r\n    }\r\n    // If no target, buffer will accumulate until target is set\r\n  }\r\n\r\n  /**\r\n   * Handle streaming completion\r\n   */\r\n  async handleStreamingComplete(data) {\r\n    console.log('[TRPGClient] Streaming complete');\r\n    \r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n\r\n    // Use full content from server if provided, otherwise fallback to collected content\r\n    const finalContent = data.content || this.currentStreamingContent;\r\n\r\n    if (target && finalContent) {\r\n      try {\r\n        // Fetch rendered markdown\r\n        const { ok, data } = await fetchJson('/api/messages/markdown', {\r\n          method: 'POST',\r\n          body: { content: finalContent }\r\n        });\r\n        \r\n        if (ok && data?.html) {\r\n          target.innerHTML = data.html;\r\n            \r\n          // Re-scroll\r\n          const output = document.getElementById('story-output');\r\n          if (output) {\r\n            output.scrollTop = output.scrollHeight;\r\n          }\r\n        } else {\r\n          console.warn('[TRPGClient] Markdown render request failed');\r\n        }\r\n      } catch (err) {\r\n        console.error('[TRPGClient] Failed to render markdown:', err);\r\n      }\r\n    } else if (!target) {\r\n      console.warn('[TRPGClient] No target element for markdown rendering');\r\n    }\r\n\r\n    this.setProcessing(false);\r\n    this.refreshStatus();\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    store.dispatch({ type: 'STREAMING_COMPLETE' });\r\n  }\r\n\r\n  /**\r\n   * Handle streaming error\r\n   */\r\n  handleStreamingError(data) {\r\n    console.error('[TRPGClient] Streaming error:', data.error);\r\n    const target = this.currentStreamingElementId \r\n      ? document.getElementById(this.currentStreamingElementId)\r\n      : null;\r\n    \r\n    if (target) {\r\n      // Safe error rendering\r\n      target.innerHTML = '';\r\n      const errorDiv = document.createElement('div');\r\n      errorDiv.className = 'error-message';\r\n      errorDiv.textContent = `Error: ${data.error || 'Unknown error'}`;\r\n      target.appendChild(errorDiv);\r\n    }\r\n    \r\n    this.setProcessing(false);\r\n  }\r\n\r\n  /**\r\n   * Disconnect SSE\r\n   */\r\n  disconnectSSE() {\r\n    this.unsubscribeHandlers.forEach((unsubscribe) => unsubscribe());\r\n    this.unsubscribeHandlers = [];\r\n  }\r\n\r\n  /**\r\n   * Append message to story output (Legacy fallback)\r\n   */\r\n  appendMessage(content) {\r\n    const output = document.getElementById('story-output');\r\n    if (!output) return;\r\n\r\n    // Create message element\r\n    const msgDiv = document.createElement('div');\r\n    msgDiv.className = 'message assistant streaming';\r\n    msgDiv.textContent = typeof content === 'string' ? content : JSON.stringify(content);\r\n\r\n    output.appendChild(msgDiv);\r\n    output.scrollTop = output.scrollHeight;\r\n\r\n    // Remove streaming class after animation\r\n    setTimeout(() => {\r\n      msgDiv.classList.remove('streaming');\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Set processing state\r\n   */\r\n  setProcessing(processing) {\r\n    this.isProcessing = processing;\r\n    const actionForm = document.getElementById('action-form');\r\n    const input = actionForm ? actionForm.querySelector('#action-input') : document.querySelector('#action-input');\r\n    const button = actionForm ? actionForm.querySelector('button[type=\"submit\"]') : null;\r\n    const spinner = document.getElementById('input-spinner');\r\n\r\n    if (input) {\r\n      input.disabled = processing;\r\n    }\r\n    if (button) {\r\n      button.disabled = processing;\r\n    }\r\n\r\n    if (spinner) {\r\n      spinner.classList.toggle('visible', processing);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send action via fetch\r\n   */\r\n  async sendAction(form) {\r\n    if (this.isProcessing) return;\r\n\r\n    const formData = new FormData(form);\r\n    const action = formData.get('action');\r\n    if (!action) return;\r\n\r\n    // Reset streaming state for new action\r\n    console.log('[TRPGClient] Starting new action, resetting streaming state');\r\n    this.currentStreamingElementId = null;\r\n    this.currentStreamingContent = '';\r\n    store.dispatch({ type: 'STREAMING_RESET' });\r\n\r\n    this.setProcessing(true);\r\n\r\n    const input = form.querySelector('#action-input');\r\n    if (input) {\r\n      input.value = '';\r\n      input.focus();\r\n    }\r\n\r\n    try {\r\n      const response = await fetchResponse('/api/rooms/collect-action', {\r\n        method: 'POST',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest'\r\n        },\r\n        body: Object.fromEntries(formData.entries()),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to send action');\r\n      }\r\n\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType && contentType.includes('text/html')) {\r\n        const html = await response.text();\r\n        const output = document.getElementById('story-output');\r\n        if (output) {\r\n          output.insertAdjacentHTML('beforeend', html);\r\n          output.scrollTop = output.scrollHeight;\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        console.log('Action recorded:', data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending action:', error);\r\n      alert('Failed to send action. Please try again.');\r\n      this.setProcessing(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Append user message to output\r\n   */\r\n  appendUserMessage(content) {\r\n    const output = document.getElementById('story-output');\r\n    if (!output) return;\r\n\r\n    const msgDiv = document.createElement('div');\r\n    msgDiv.className = 'message user';\r\n    msgDiv.innerHTML = `<div class=\"message-header\">You</div><div class=\"message-content\">${this.escapeHtml(content)}</div>`;\r\n\r\n    output.appendChild(msgDiv);\r\n    output.scrollTop = output.scrollHeight;\r\n  }\r\n\r\n  /**\r\n   * Escape HTML to prevent XSS\r\n   */\r\n  escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Refresh status bar\r\n   */\r\n  async refreshStatus() {\r\n    if (typeof window.loadStatusPanel === 'function') {\r\n      return window.loadStatusPanel();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Character Form Utilities\r\n */\r\nexport class CharacterForm {\r\n  constructor() {\r\n    this.initAbilityScoreModifiers();\r\n    this.initPointBuy();\r\n  }\r\n\r\n  /**\r\n   * Update modifier display when ability scores change\r\n   */\r\n  initAbilityScoreModifiers() {\r\n    const inputs = document.querySelectorAll('.ability-score input');\r\n    inputs.forEach((input) => {\r\n      input.addEventListener('input', () => {\r\n        this.updateModifier(input);\r\n        this.updatePointBuyTotal();\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update modifier display for an ability score\r\n   */\r\n  updateModifier(input) {\r\n    const score = parseInt(input.value) || 10;\r\n    const modifier = Math.floor((score - 10) / 2);\r\n    const modifierSpan = input.parentElement.querySelector('.modifier');\r\n    if (modifierSpan) {\r\n      modifierSpan.textContent = modifier >= 0 ? `+${modifier}` : `${modifier}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize point buy system (optional)\r\n   */\r\n  initPointBuy() {\r\n    // TODO: Implement point buy system\r\n  }\r\n\r\n  /**\r\n   * Update point buy total\r\n   */\r\n  updatePointBuyTotal() {\r\n    // TODO: Calculate point buy cost\r\n  }\r\n}\r\n", "/**\r\n * Player Notes Management Module\r\n * Handles adding, deleting and syncing player notes\r\n */\r\n\r\nimport { fetchJson } from './api.js';\r\n\r\nexport class PlayerNotesManager {\r\n  constructor(roomId, userId) {\r\n    this.roomId = roomId;\r\n    this.userId = userId;\r\n    this.notesList = null;\r\n    this.input = null;\r\n    this.addButton = null;\r\n  }\r\n\r\n  init() {\r\n    // Cache DOM references\r\n    this.notesList = document.getElementById('player-notes-list');\r\n    this.input = document.querySelector('.note-input');\r\n    this.addButton = document.querySelector('.note-add');\r\n\r\n    if (!this.notesList || !this.input || !this.addButton) {\r\n      console.warn('[PlayerNotes] Required DOM elements not found');\r\n      return;\r\n    }\r\n\r\n    // Setup event listeners\r\n    this.setupEventListeners();\r\n\r\n    // Setup delete handlers for existing notes (rendered server-side)\r\n    this.setupExistingNoteHandlers();\r\n\r\n    // Setup SSE listeners for real-time updates from other players\r\n    this.setupSSEListeners();\r\n\r\n    // Sync empty state on initial load\r\n    this.updateEmptyState();\r\n\r\n    console.log('[PlayerNotes] Initialized for room', this.roomId);\r\n  }\r\n\r\n  setupExistingNoteHandlers() {\r\n    // We'll use event delegation on notesList instead of individual listeners\r\n    if (this.notesList) {\r\n      // Remove old delegation if it exists to avoid double triggers\r\n      // (though in current setup simple replacement should be fine)\r\n      const newList = this.notesList.cloneNode(true);\r\n      this.notesList.replaceWith(newList);\r\n      this.notesList = newList;\r\n\r\n      this.notesList.addEventListener('click', (e) => {\r\n        const deleteBtn = e.target.closest('.note-delete');\r\n        if (deleteBtn) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          const noteElement = deleteBtn.closest('.note-item');\r\n          const noteId = deleteBtn.getAttribute('data-note-id');\r\n          if (noteElement && noteId) {\r\n            this.handleDeleteNote(noteElement, noteId);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  setupEventListeners() {\r\n    // Add button click handler\r\n    this.addButton.addEventListener('click', (e) => this.handleAddNote(e));\r\n\r\n    // Enter key in input handler\r\n    this.input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.handleAddNote(e);\r\n      }\r\n    });\r\n\r\n    // Auto-resize textarea\r\n    this.input.addEventListener('input', () => {\r\n      this.input.style.height = 'auto';\r\n      this.input.style.height = (this.input.scrollHeight) + 'px';\r\n    });\r\n  }\r\n\r\n  setupSSEListeners() {\r\n    // SSE listeners for real-time sync will be added later\r\n    console.log('[PlayerNotes] SSE listeners disabled for now');\r\n  }\r\n\r\n  async handleAddNote(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    if (this.addButton.disabled) return;\r\n\r\n    const note = this.input.value.trim();\r\n    if (!note) return;\r\n\r\n    const trimmed = note.slice(0, 200);\r\n\r\n    // Optimistic UI: show loading state\r\n    this.addButton.disabled = true;\r\n    this.addButton.textContent = '...';\r\n    const originalValue = this.input.value;\r\n    this.input.value = '';\r\n\r\n    try {\r\n      const { ok, data } = await fetchJson(`/api/rooms/${this.roomId}/notes`, {\r\n        method: 'POST',\r\n        body: { note: trimmed }\r\n      });\r\n\r\n      if (ok && data?.success) {\r\n        const newNote = data.notes[data.notes.length - 1];\r\n        if (newNote) {\r\n          this.addNoteToDOM(newNote);\r\n        }\r\n      } else {\r\n        this.input.value = originalValue;\r\n        alert(data?.error || 'Failed to add note');\r\n      }\r\n    } catch (error) {\r\n      console.error('[PlayerNotes] Failed to add note:', error);\r\n      this.input.value = originalValue;\r\n      alert('Failed to add note');\r\n    } finally {\r\n      this.addButton.disabled = false;\r\n      this.addButton.textContent = 'Add';\r\n      this.input.style.height = 'auto';\r\n      this.input.focus();\r\n    }\r\n  }\r\n\r\n  async handleDeleteNote(noteElement, noteId) {\r\n    if (noteElement.dataset.deleting === 'true') return;\r\n\r\n    noteElement.dataset.deleting = 'true';\r\n    noteElement.style.opacity = '0.5';\r\n\r\n    try {\r\n      const { ok, data } = await fetchJson(`/api/rooms/${this.roomId}/notes/${noteId}`, {\r\n        method: 'DELETE'\r\n      });\r\n\r\n      if (ok && data?.success) {\r\n        noteElement.remove();\r\n        // No longer need to resync indices - notes have stable IDs\r\n        this.updateEmptyState();\r\n      } else {\r\n        noteElement.dataset.deleting = '';\r\n        noteElement.style.opacity = '1';\r\n        alert(data?.error || 'Failed to delete note');\r\n      }\r\n    } catch (error) {\r\n      console.error('[PlayerNotes] Failed to delete note:', error);\r\n      noteElement.dataset.deleting = '';\r\n      noteElement.style.opacity = '1';\r\n      alert('Failed to delete note');\r\n    } finally {\r\n      setTimeout(() => {\r\n        if (noteElement.parentNode) {\r\n          delete noteElement.dataset.deleting;\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  addNoteToDOM(note) {\r\n    const noteElement = document.createElement('div');\r\n    noteElement.className = 'note-item';\r\n    noteElement.dataset.noteId = note.id;\r\n\r\n    noteElement.innerHTML = `\r\n      <span class=\"note-text\">${this.escapeHtml(note.content)}</span>\r\n      <button class=\"note-delete\" data-note-id=\"${note.id}\" title=\"Delete note\">\u00D7</button>\r\n    `;\r\n\r\n    const emptyState = this.notesList.querySelector('.empty-state');\r\n    if (emptyState) {\r\n      emptyState.style.display = 'none';\r\n    }\r\n\r\n    this.notesList.appendChild(noteElement);\r\n  }\r\n\r\n  updateEmptyState() {\r\n    const hasNotes = this.notesList.querySelectorAll('.note-item').length > 0;\r\n    const emptyState = this.notesList.querySelector('.empty-state');\r\n    if (emptyState) {\r\n      emptyState.style.display = hasNotes ? 'none' : 'block';\r\n    }\r\n  }\r\n\r\n  escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n", "/**\r\n * Chat Management Module\r\n * Handles loading, rendering and sending chat messages\r\n */\r\n\r\nimport { fetchJson } from './api.js';\r\n\r\nexport class ChatManager {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.currentUserId = this.getCurrentUserId();\r\n    this.messagesContainer = document.getElementById('chat-messages');\r\n  }\r\n\r\n  getCurrentUserId() {\r\n    const metaTag = document.querySelector('meta[name=\"user-id\"]');\r\n    return metaTag ? metaTag.getAttribute('content') : null;\r\n  }\r\n\r\n  async loadInitialMessages() {\r\n    if (!this.messagesContainer) return;\r\n\r\n    try {\r\n      const { ok, data } = await fetchJson(`/api/chat/rooms/${this.roomId}/messages?limit=50`);\r\n\r\n      if (ok && data?.success && data.messages) {\r\n        this.messagesContainer.innerHTML = '';\r\n        data.messages.forEach((msg) => this.renderMessage(msg));\r\n        this.scrollToBottom();\r\n      } else {\r\n        this.messagesContainer.innerHTML = '<div class=\"chat-loading\">No messages yet</div>';\r\n      }\r\n    } catch (error) {\r\n      console.error('[Chat] Failed to load messages:', error);\r\n      if (this.messagesContainer) {\r\n        this.messagesContainer.innerHTML = '<div class=\"chat-loading\">Failed to load messages</div>';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render a single chat message\r\n   * @param {Object} message - Message object\r\n   */\r\n  renderMessage(message) {\r\n    if (!this.messagesContainer) return;\r\n\r\n    // Remove loading indicator if present\r\n    const loading = this.messagesContainer.querySelector('.chat-loading');\r\n    if (loading) loading.remove();\r\n\r\n    const isSelf = this.currentUserId === message.playerId;\r\n    const isSystem = message.type === 'system';\r\n\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.className = `chat-message${isSelf ? ' self' : ''}${isSystem ? ' system' : ''}`;\r\n    messageDiv.dataset.messageId = message.id;\r\n\r\n    const time = new Date(message.timestamp);\r\n    const timeStr = time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });\r\n\r\n    messageDiv.innerHTML = `\r\n      <div class=\"chat-message-header\">\r\n        <span class=\"chat-message-player\">${this.escapeHtml(message.playerName)}</span>\r\n        <span class=\"chat-message-time\">${timeStr}</span>\r\n      </div>\r\n      <div class=\"chat-message-text\">${this.escapeHtml(message.message)}</div>\r\n    `;\r\n\r\n    this.messagesContainer.appendChild(messageDiv);\r\n  }\r\n\r\n  scrollToBottom() {\r\n    if (this.messagesContainer) {\r\n      this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\r\n    }\r\n  }\r\n\r\n  escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Setup chat form handlers\r\n   */\r\n  setupFormHandler() {\r\n    const form = document.getElementById('chat-form');\r\n    if (!form) return;\r\n\r\n    const textarea = form.querySelector('textarea[name=\"message\"]');\r\n    if (!textarea) return;\r\n\r\n    // Auto-resize textarea as user types\r\n    const autoResize = () => {\r\n      textarea.style.height = '42px'; // Reset to min-height\r\n      const newHeight = Math.min(Math.max(textarea.scrollHeight, 42), 120);\r\n      textarea.style.height = newHeight + 'px';\r\n    };\r\n\r\n    textarea.addEventListener('input', autoResize);\r\n\r\n    // Handle Enter key to send, Shift+Enter for new line\r\n    textarea.addEventListener('keydown', (event) => {\r\n      if (event.key === 'Enter' && !event.shiftKey) {\r\n        event.preventDefault();\r\n        form.dispatchEvent(new Event('submit'));\r\n      }\r\n    });\r\n\r\n    form.addEventListener('submit', async (event) => {\r\n      event.preventDefault();\r\n\r\n      const messageContent = textarea.value.trim();\r\n      if (!messageContent) return;\r\n\r\n      const originalMessage = messageContent;\r\n      textarea.value = '';\r\n      autoResize();\r\n\r\n      const button = form.querySelector('button');\r\n      if (button) button.disabled = true;\r\n\r\n      try {\r\n        const { ok, data } = await fetchJson(`/api/chat/rooms/${this.roomId}/send`, {\r\n          method: 'POST',\r\n          body: { message: messageContent }\r\n        });\r\n\r\n        if (!ok) {\r\n          console.error('[Chat] Failed to send:', data?.error);\r\n          textarea.value = originalMessage;\r\n          autoResize();\r\n        }\r\n      } catch (error) {\r\n        console.error('[Chat] Error sending:', error);\r\n        textarea.value = originalMessage;\r\n        autoResize();\r\n      } finally {\r\n        if (button) button.disabled = false;\r\n        textarea.focus();\r\n      }\r\n    });\r\n  }\r\n}\r\n", "/**\r\n * Room Members Module\r\n * Renders member list and subscribes to members-updated SSE events.\r\n */\r\n\r\nimport { sseBus } from './sseBus.js';\r\nimport { fetchJson } from './api.js';\r\n\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = String(text ?? '');\r\n  return div.innerHTML;\r\n}\r\n\r\nexport class RoomMembersManager {\r\n  constructor(roomId) {\r\n    this.roomId = roomId;\r\n    this.membersList = document.getElementById('members-list');\r\n    this.currentUserId = this.getCurrentUserId();\r\n    this.unsubscribe = null;\r\n  }\r\n\r\n  getCurrentUserId() {\r\n    const metaTag = document.querySelector('meta[name=\"user-id\"]');\r\n    return metaTag ? metaTag.getAttribute('content') : null;\r\n  }\r\n\r\n  async loadInitialMembers() {\r\n    if (!this.membersList) return;\r\n\r\n    try {\r\n      const { ok, data } = await fetchJson(`/api/rooms/${this.roomId}/members`);\r\n\r\n      if (ok && data?.success) {\r\n        this.renderMembers(data.members, data.maxPlayers);\r\n      } else {\r\n        this.renderError('Failed to load members');\r\n      }\r\n    } catch (error) {\r\n      console.error('[Members] Failed to load:', error);\r\n      this.renderError('Failed to load members');\r\n    }\r\n  }\r\n\r\n  connect() {\r\n    sseBus.connect(this.roomId);\r\n    this.unsubscribe = sseBus.on('members-updated', (data) => {\r\n      if (!data) return;\r\n      this.renderMembers(data.members || [], data.maxPlayers || 0);\r\n    });\r\n  }\r\n\r\n  renderMembers(members, maxPlayers) {\r\n    if (!this.membersList) return;\r\n\r\n    const loading = this.membersList.querySelector('.members-loading');\r\n    if (loading) loading.remove();\r\n\r\n    const error = this.membersList.querySelector('.members-error');\r\n    if (error) error.remove();\r\n\r\n    const safeMax = maxPlayers || members.length || 0;\r\n    this.membersList.innerHTML = `\r\n      <div class=\"members-count\">${members.length}/${safeMax}</div>\r\n    `;\r\n\r\n    if (members.length === 0) {\r\n      this.membersList.innerHTML += '<div class=\"empty-members\">No members yet</div>';\r\n      return;\r\n    }\r\n\r\n    members.forEach(member => {\r\n      const isSelf = this.currentUserId === member.userId;\r\n      const div = document.createElement('div');\r\n      div.className = `member-item${isSelf ? ' self' : ''}`;\r\n      div.innerHTML = `\r\n        <span class=\"member-name\">${escapeHtml(member.username)}</span>${member.characterName ? ` <span class=\"member-character\">(${escapeHtml(member.characterName)})</span>` : ''}\r\n      `;\r\n      this.membersList.appendChild(div);\r\n    });\r\n  }\r\n\r\n  renderError(message) {\r\n    if (!this.membersList) return;\r\n\r\n    const loading = this.membersList.querySelector('.members-loading');\r\n    if (loading) loading.remove();\r\n\r\n    this.membersList.innerHTML = `<div class=\"members-error\">${escapeHtml(message)}</div>`;\r\n  }\r\n\r\n  destroy() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n      this.unsubscribe = null;\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Combat Events\r\n * Default renderers for dice rolls and action restrictions.\r\n */\r\n\r\nimport { store } from './store.js';\r\n\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = String(text ?? '');\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction getCombatTargets() {\r\n  return {\r\n    fullLog: document.getElementById('combat-log-full'),\r\n    status: document.getElementById('turn-gate-status')\r\n  };\r\n}\r\n\r\nfunction renderDiceRollEntry(rollData) {\r\n  const entry = document.createElement('div');\r\n  const success = !!rollData?.success;\r\n  entry.className = `dice-roll-entry ${success ? 'success' : 'failure'}`;\r\n\r\n  const characterName = escapeHtml(rollData?.characterName || 'Unknown');\r\n  const checkType = escapeHtml(rollData?.checkType || 'Check');\r\n  const ability = escapeHtml(rollData?.ability || '');\r\n  const dc = rollData?.dc !== undefined ? `DC ${escapeHtml(rollData.dc)}` : '';\r\n  const formula = escapeHtml(rollData?.roll?.formula || '');\r\n  const total = rollData?.roll?.total !== undefined ? rollData.roll.total : '';\r\n  const reason = escapeHtml(rollData?.reason || '');\r\n\r\n  // Match CSS class names: .roll-header, .character-name, .check-type, etc.\r\n  entry.innerHTML = `\r\n    <div class=\"roll-header\">\r\n      <span class=\"character-name\">${characterName}</span>\r\n      <span class=\"check-type\">${checkType.replace('_', ' ')}</span>\r\n    </div>\r\n    <div class=\"roll-detail\">\r\n      <span class=\"ability\">${ability}</span>\r\n      <span class=\"dc\">${dc}</span>\r\n    </div>\r\n    <div class=\"roll-detail\">\r\n      <span>${formula} = <strong>${escapeHtml(total)}</strong></span>\r\n      <span class=\"result ${success ? 'success' : 'failure'}\">${success ? '\u2713 Success' : '\u2717 Failure'}</span>\r\n    </div>\r\n    ${reason ? `<div class=\"roll-reason\">${reason}</div>` : ''}\r\n  `;\r\n\r\n  return entry;\r\n}\r\n\r\nfunction renderActionRestriction(eventData) {\r\n  const { status } = getCombatTargets();\r\n  if (!status) return;\r\n\r\n  const reason = escapeHtml(eventData?.reason || 'Action restricted');\r\n  const allowed = Array.isArray(eventData?.allowedCharacterIds)\r\n    ? eventData.allowedCharacterIds.join(', ')\r\n    : '';\r\n\r\n  status.innerHTML = `\r\n    <div class=\"action-restriction\">\r\n      <div class=\"action-restriction-title\">Action Restricted</div>\r\n      <div class=\"action-restriction-reason\">${reason}</div>\r\n      ${allowed ? `<div class=\"action-restriction-allowed\">Allowed: ${escapeHtml(allowed)}</div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction generateDedupeKey(type, data) {\r\n  return `${type}-${JSON.stringify(data)}`;\r\n}\r\n\r\nfunction renderDiceRoll(rollData) {\r\n  console.log('[CombatEvents] renderDiceRoll called with:', rollData);\r\n  const key = generateDedupeKey('dice-roll', rollData);\r\n  const entry = renderDiceRollEntry(rollData);\r\n\r\n  store.dispatch({\r\n    type: 'COMBAT_ADD_ENTRY',\r\n    payload: { key, entry: rollData },\r\n  });\r\n\r\n  const { fullLog } = getCombatTargets();\r\n\r\n  console.log('[CombatEvents] fullLog element:', fullLog);\r\n  console.log('[CombatEvents] Checking for #combat-log-full:', document.getElementById('combat-log-full'));\r\n\r\n  if (fullLog) {\r\n    // Remove empty state if present\r\n    const emptyState = fullLog.querySelector('.empty-state');\r\n    if (emptyState) {\r\n      emptyState.remove();\r\n      console.log('[CombatEvents] Removed empty state');\r\n    }\r\n    fullLog.prepend(entry);\r\n    console.log('[CombatEvents] Added dice roll entry to combat log');\r\n  } else {\r\n    console.error('[CombatEvents] fullLog element not found! Looking for #combat-log-full');\r\n    console.error('[CombatEvents] All elements with id containing \"combat\":', \r\n      Array.from(document.querySelectorAll('[id*=\"combat\"]')).map(el => el.id)\r\n    );\r\n  }\r\n}\r\n\r\nexport function registerCombatHandlers(sseBus) {\r\n  if (!sseBus) {\r\n    console.error('[CombatEvents] sseBus is null or undefined!');\r\n    return () => {};\r\n  }\r\n\r\n  console.log('[CombatEvents] Registering combat handlers');\r\n\r\n  const unsubDice = sseBus.onMessageType('dice-roll', (payload) => {\r\n    console.log('[CombatEvents] dice-roll event received:', payload);\r\n    if (payload?.data) {\r\n      renderDiceRoll(payload.data);\r\n    } else {\r\n      console.warn('[CombatEvents] dice-roll payload has no data:', payload);\r\n    }\r\n  });\r\n\r\n  const unsubRestriction = sseBus.onMessageType('action-restriction', (payload) => {\r\n    console.log('[CombatEvents] action-restriction event received:', payload);\r\n    renderActionRestriction(payload);\r\n  });\r\n\r\n  console.log('[CombatEvents] Combat handlers registered successfully');\r\n\r\n  return () => {\r\n    console.log('[CombatEvents] Unregistering combat handlers');\r\n    unsubDice?.();\r\n    unsubRestriction?.();\r\n  };\r\n}\r\n", "/**\r\n * Game Page Entry Point\r\n * Initializes game-specific functionality\r\n */\r\nimport { TRPGClient, SaveMenuManager, CharacterForm } from './modules/game.js';\r\nimport { PlayerNotesManager } from './modules/notes.js';\r\nimport { ChatManager } from './modules/chat.js';\r\nimport { RoomMembersManager } from './modules/members.js';\r\nimport { registerCombatHandlers } from './modules/combatEvents.js';\r\nimport { sseBus } from './modules/sseBus.js';\r\nimport { fetchText } from './modules/api.js';\r\nimport { store } from './modules/store.js';\r\n\r\n// Global references\r\nlet playerNotesManager = null;\r\nlet roomChat = null;\r\nlet roomMembers = null;\r\nlet unregisterCombatHandlers = null;\r\n\r\n/**\r\n * Rehydrate status panel subtree after HTML replacement\r\n */\r\nfunction rehydrateStatusSubtree(roomId, userId) {\r\n  if (userId && roomId) {\r\n    playerNotesManager = new PlayerNotesManager(roomId, userId);\r\n    playerNotesManager.init();\r\n  }\r\n}\r\n\r\n/**\r\n * Load and refresh the status panel content\r\n */\r\nwindow.loadStatusPanel = async function() {\r\n  const statusPanel = document.getElementById('status-panel');\r\n  if (!statusPanel) return;\r\n\r\n  const gamePage = document.querySelector('.game-container');\r\n  const roomId = gamePage?.getAttribute('data-room-id');\r\n  if (!roomId) return;\r\n\r\n  const state = store.getState();\r\n  const currentSeq = state.statusPanel.requestSeq;\r\n  store.dispatch({ type: 'STATUS_PANEL_LOADING' });\r\n  const requestSeq = store.getState().statusPanel.requestSeq;\r\n\r\n  try {\r\n    const { ok, text } = await fetchText(`/partials/room/${roomId}/status`);\r\n    if (ok) {\r\n      const html = text;\r\n      const statusBody = document.getElementById('status-body');\r\n      if (statusBody) {\r\n        statusBody.innerHTML = html;\r\n        \r\n        store.dispatch({ \r\n          type: 'STATUS_PANEL_LOADED', \r\n          payload: { seq: requestSeq } \r\n        });\r\n\r\n        const userMeta = document.querySelector('meta[name=\"user-id\"]');\r\n        const userId = userMeta ? userMeta.getAttribute('content') : null;\r\n        rehydrateStatusSubtree(roomId, userId);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Status Panel] Failed to load:', error);\r\n    store.dispatch({ \r\n      type: 'STATUS_PANEL_LOADED', \r\n      payload: { seq: requestSeq } \r\n    });\r\n  }\r\n};\r\n\r\n// Wait for DOM to be ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  // Check if we're on the game page\r\n  const gameContainer = document.querySelector('.game-container');\r\n  const roomId = gameContainer?.dataset.roomId;\r\n  \r\n  if (roomId) {\r\n    // Initialize store with room\r\n    store.dispatch({ type: 'INIT_ROOM', payload: roomId });\r\n\r\n    // Initialize game client\r\n    window.gameClient = new TRPGClient(roomId);\r\n\r\n    // Initialize save menu manager\r\n    window.saveMenu = new SaveMenuManager(roomId);\r\n\r\n    // Initialize dice roll and action restriction areas\r\n    createGameEventAreas();\r\n\r\n    // Register combat event handlers BEFORE connecting SSE\r\n    console.log('[GameClient] Registering combat handlers with sseBus');\r\n    unregisterCombatHandlers = registerCombatHandlers(sseBus);\r\n    console.log('[GameClient] Combat handlers registered');\r\n\r\n    // Handle action form submission\r\n    const actionForm = document.getElementById('action-form');\r\n    if (actionForm) {\r\n      actionForm.addEventListener('submit', (e) => {\r\n        e.preventDefault();\r\n        window.gameClient.sendAction(actionForm);\r\n      });\r\n    }\r\n\r\n    // Initialize player notes manager\r\n    const userMeta = document.querySelector('meta[name=\"user-id\"]');\r\n    const userId = userMeta ? userMeta.getAttribute('content') : null;\r\n    rehydrateStatusSubtree(roomId, userId);\r\n\r\n    // Initialize chat manager\r\n    roomChat = new ChatManager(roomId);\r\n    roomChat.loadInitialMessages();\r\n    roomChat.setupFormHandler();\r\n\r\n    // Initialize members manager\r\n    roomMembers = new RoomMembersManager(roomId);\r\n    roomMembers.loadInitialMembers();\r\n    roomMembers.connect();\r\n\r\n    // Setup tab switching\r\n    setupTabs();\r\n\r\n    // Connect to SSE stream\r\n    window.gameClient.connectSSE({\r\n      onChat: (msg) => roomChat.renderMessage(msg)\r\n    });\r\n\r\n    // Refresh status panel for ALL room players when any turn ends\r\n    sseBus.onMessageType('turn_end', () => {\r\n      if (typeof window.loadStatusPanel === 'function') {\r\n        window.loadStatusPanel();\r\n      }\r\n    });\r\n\r\n    // Setup MutationObserver to catch new streaming-response elements\r\n    setupMutationObserver(window.gameClient);\r\n  }\r\n\r\n  // Initialize character form if on character creation page\r\n  const characterForm = document.querySelector('.character-form');\r\n  if (characterForm) {\r\n    new CharacterForm();\r\n  }\r\n\r\n  window.addEventListener('beforeunload', () => {\r\n    if (roomMembers) roomMembers.destroy();\r\n    if (unregisterCombatHandlers) unregisterCombatHandlers();\r\n  });\r\n});\r\n\r\n/**\r\n * Create game event display areas (dice rolls, action restrictions)\r\n */\r\nfunction createGameEventAreas() {\r\n  const statusBody = document.getElementById('status-body');\r\n  if (!statusBody) {\r\n    console.warn('[GameClient] status-body not found');\r\n    return;\r\n  }\r\n\r\n  // Create turn gate status area if not exists\r\n  let turnGateStatus = document.getElementById('turn-gate-status');\r\n  if (!turnGateStatus) {\r\n    turnGateStatus = document.createElement('div');\r\n    turnGateStatus.id = 'turn-gate-status';\r\n    statusBody.appendChild(turnGateStatus);\r\n    console.log('[GameClient] Created turn-gate-status element');\r\n  }\r\n\r\n  // Check if combat-log-full exists\r\n  const combatLogFull = document.getElementById('combat-log-full');\r\n  if (combatLogFull) {\r\n    console.log('[GameClient] combat-log-full element found:', combatLogFull);\r\n  } else {\r\n    console.error('[GameClient] combat-log-full element NOT FOUND in DOM!');\r\n  }\r\n}\r\n\r\n/**\r\n * Setup MutationObserver to detect new elements from HTMX or actions\r\n */\r\nfunction setupMutationObserver(client) {\r\n  const storyOutput = document.getElementById('story-output');\r\n  if (!storyOutput) return;\r\n\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      if (mutation.type === 'childList') {\r\n        for (const node of mutation.addedNodes) {\r\n          if (node.nodeType === Node.ELEMENT_NODE) {\r\n            // Check if this node is a streaming response container\r\n            const streamingContainer = node.id?.startsWith('streaming-response-') \r\n              ? node \r\n              : node.querySelector('[id^=\"streaming-response-\"]');\r\n\r\n            if (streamingContainer && streamingContainer.id) {\r\n              // Only set if this is a freshly added element (just added to DOM)\r\n              // The element should be empty or only contain a streaming indicator\r\n              // Use children.length instead of childNodes.length to ignore whitespace text nodes\r\n              const isEmpty = streamingContainer.children.length === 0 ||\r\n                (streamingContainer.children.length === 1 &&\r\n                 streamingContainer.querySelector('.streaming-indicator'));\r\n\r\n              if (isEmpty) {\r\n                console.log('[MutationObserver] New streaming container detected:', streamingContainer.id);\r\n                client.setStreamingElementId(streamingContainer.id);\r\n              } else {\r\n                console.log('[MutationObserver] Streaming container has content, skipping:', streamingContainer.id);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  observer.observe(storyOutput, { childList: true, subtree: true });\r\n}\r\n\r\n/**\r\n * Setup tab switching logic\r\n */\r\nfunction setupTabs() {\r\n  const tabBtns = document.querySelectorAll('.tab-btn');\r\n  const statusPanel = document.getElementById('status-panel');\r\n  const combatPanel = document.getElementById('combat-log-panel');\r\n  const notesPanel = document.getElementById('notes-panel');\r\n  const chatPanel = document.getElementById('chat-panel');\r\n  const savesPanel = document.getElementById('saves-panel');\r\n\r\n  // Setup scrollable tabs functionality\r\n  setupScrollableTabs();\r\n\r\n  tabBtns.forEach((btn) => {\r\n    btn.addEventListener('click', (e) => {\r\n      e.preventDefault();\r\n      const tab = btn.getAttribute('data-tab');\r\n\r\n      tabBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n\r\n      // Hide all panels\r\n      [statusPanel, combatPanel, notesPanel, chatPanel, savesPanel].forEach(p => {\r\n        if (p) {\r\n          p.classList.add('hidden');\r\n          p.style.display = 'none';\r\n        }\r\n      });\r\n\r\n      // Show selected panel\r\n      let selectedPanel = null;\r\n      if (tab === 'status') selectedPanel = statusPanel;\r\n      else if (tab === 'combat-log') selectedPanel = combatPanel;\r\n      else if (tab === 'notes') selectedPanel = notesPanel;\r\n      else if (tab === 'chat') selectedPanel = chatPanel;\r\n      else if (tab === 'saves') selectedPanel = savesPanel;\r\n\r\n      if (selectedPanel) {\r\n        selectedPanel.classList.remove('hidden');\r\n        selectedPanel.style.display = '';\r\n\r\n        // Load status panel content when tab is shown\r\n        if (tab === 'status') {\r\n          window.loadStatusPanel();\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Setup scrollable tabs with arrow buttons and fade indicators\r\n */\r\nfunction setupScrollableTabs() {\r\n  const wrapper = document.getElementById('sidebar-tabs-wrapper');\r\n  const tabsContainer = document.getElementById('sidebar-tabs');\r\n  const scrollLeftBtn = document.getElementById('tab-scroll-left');\r\n  const scrollRightBtn = document.getElementById('tab-scroll-right');\r\n\r\n  if (!wrapper || !tabsContainer) return;\r\n\r\n  // Check scroll state and update UI\r\n  function updateScrollState() {\r\n    const canScrollLeft = tabsContainer.scrollLeft > 0;\r\n    const canScrollRight = tabsContainer.scrollLeft < (tabsContainer.scrollWidth - tabsContainer.clientWidth - 1);\r\n\r\n    wrapper.classList.toggle('can-scroll-left', canScrollLeft);\r\n    wrapper.classList.toggle('can-scroll-right', canScrollRight);\r\n\r\n    if (scrollLeftBtn) scrollLeftBtn.disabled = !canScrollLeft;\r\n    if (scrollRightBtn) scrollRightBtn.disabled = !canScrollRight;\r\n  }\r\n\r\n  // Scroll buttons\r\n  if (scrollLeftBtn) {\r\n    scrollLeftBtn.addEventListener('click', () => {\r\n      tabsContainer.scrollBy({ left: -100, behavior: 'smooth' });\r\n    });\r\n  }\r\n\r\n  if (scrollRightBtn) {\r\n    scrollRightBtn.addEventListener('click', () => {\r\n      tabsContainer.scrollBy({ left: 100, behavior: 'smooth' });\r\n    });\r\n  }\r\n\r\n  // Update scroll state on scroll and resize\r\n  tabsContainer.addEventListener('scroll', updateScrollState);\r\n  window.addEventListener('resize', updateScrollState);\r\n\r\n  // Initial check\r\n  setTimeout(updateScrollState, 100);\r\n}\r\n"],
  "mappings": "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",
  "names": ["initialState", "data", "escapeHtml", "sseBus"]
}
